# Render Blueprint for Building Status
# https://render.com/docs/blueprint-spec

services:
  # Next.js Web Service
  - type: web
    name: building-status
    runtime: node
    region: oregon
    plan: free
    branch: next-ts-migration
    buildCommand: npm install && npm run build
    startCommand: npm run start
    envVars:
      - key: NODE_ENV
        value: production
      - key: DATABASE_URL
        fromDatabase:
          name: building-status-db
          property: connectionString
      - key: EDITOR_PASSWORD_HASH
        sync: false  # Must be set manually in Render dashboard
      - key: NEXT_PUBLIC_SITE_URL
        sync: false  # Must be set manually in Render dashboard
    autoDeploy: true
    healthCheckPath: /

databases:
  # PostgreSQL Database
  - name: building-status-db
    databaseName: building_status
    region: oregon
    plan: free
    ipAllowList: []  # Allow connections from anywhere (safe for free tier)

# After initial deployment:
# 1. Set environment variables in Render dashboard:
#    - EDITOR_PASSWORD_HASH (generate with: node -e "const bcrypt = require('bcryptjs'); bcrypt.hash('your-password', 10).then(console.log);")
#    - NEXT_PUBLIC_SITE_URL (your render URL: https://building-status.onrender.com)
#
# 2. Run database migrations:
#    - Connect via SSH: render ssh building-status
#    - Run: npm run db:migrate
#    - Run: npm run db:seed
#
# 3. Database management:
#    - Get connection string from Render dashboard
#    - Connect locally: psql <connection-string>
#    - Or use Render's built-in database browser
